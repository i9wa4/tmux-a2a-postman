# Postman Configuration
# File-based communication daemon for tmux panes

# =============================================================================
# Template Variables Reference
# =============================================================================
#
# notification_template:
#   {from_node}      - Sender node name
#   {node}           - Recipient node name
#   {timestamp}      - Message timestamp (YYYYMMDD-HHMMSS)
#   {inbox_path}     - Full path to recipient's inbox directory
#   {filename}       - Message filename
#   {talks_to_line}  - Formatted list of nodes this node can communicate with
#   {template}       - Node's role template (from [node].template)
#   {reply_command}  - Command to create draft message
#   {context_id}     - Current session context ID
#   {session_dir}    - Session directory path
#
# ping_template:
#   {context_id}     - Current session context ID
#   {node}           - Target node name
#   {timestamp}      - Message timestamp (YYYYMMDD-HHMMSS)
#   {from_node}      - Sender node name (always "postman")
#   {template}       - Node's role template
#   {talks_to_line}  - Formatted list of nodes this node can communicate with
#   {active_nodes}   - Comma-separated list of all active nodes
#   {reply_command}  - Command to create draft message
#   {session_dir}    - Session directory path
#
# draft_template:
#   {context_id}     - Current session context ID
#   {task_id}        - Unique task identifier
#   {sender}         - Sender node name
#   {recipient}      - Recipient node name
#   {timestamp}      - ISO format timestamp
#   {from}           - Alias for {sender} (backward compatibility)
#   {to}             - Alias for {recipient} (backward compatibility)
#
# common_template:
#   Shared template string prepended to all node templates.
#   Applied in ping and notification contexts. Not applied to draft.
#
# edge_violation_warning_template:
#   {context_id}          - Current session context ID
#   {node}                - Recipient node name (sender of the denied message)
#   {timestamp}           - ISO format timestamp
#   {attempted_recipient} - Node name that the sender attempted to send to
#   {allowed_edges}       - Comma-separated list of allowed neighbors
#   {reply_command}       - Command to create draft message
#
# =============================================================================

[postman]
# A2A protocol version
a2a_version = "1.0"

# Timing settings
scan_interval_seconds = 1.0        # Pane rescan interval
tmux_timeout_seconds = 5.0         # Timeout for tmux commands
enter_delay_seconds = 0.5          # Delay before sending Enter key
startup_delay_seconds = 2.0        # Initial startup delay
new_node_ping_delay_seconds = 3.0  # Delay before sending ping to newly joined nodes
reminder_interval_seconds = 0.0    # Send reminder after N messages (0 = disabled)

# TUI settings
edge_activity_seconds = 60.0       # TUI edge glow duration (1-3600)

# Node state thresholds
node_active_seconds = 300          # 0-5min: active (green)
node_idle_seconds = 900            # 5-15min: idle (orange), 15min+: stale (red)
node_stale_seconds = 900           # Memory cleanup threshold for pane capture state

# Pane capture settings (hybrid idle detection)
pane_capture_enabled = true
pane_capture_interval_seconds = 60.0
pane_capture_max_panes = 0          # 0 = unlimited, >0 = limit pane count

# Paths
# base_dir = ""                    # Override session dir (default: XDG_STATE_HOME/tmux-a2a-postman)

# Routing edges (bidirectional)
# Format: "node-a -- node-b" or "node-a --> node-b"
# Example multi-hop: "node-a -- node-b -- node-c" creates edges A↔B, B↔C
# edges = [
#   "node-a -- node-b",
#   "node-b -- node-c",
# ]
edges = []

# Global settings
# reply_command = "tmux-a2a-postman create-draft --context-id {context_id} --to <recipient>"
# ui_node = "messenger"            # TUI target node for watchdog alerts

# Reminder message (sent periodically to nodes)
# reminder_message = ""

# Common template (prepended to all node templates)
# common_template = ""

# Notification template (when new message arrives)
# notification_template = """
# Message from {from_node}
# File: {filename}
# Inbox: {inbox_path}
# """

# Ping message template
# ping_template = """
# PING from postman
# Reply with PONG to confirm you are active.
# """

# Draft message template
# draft_template = """---
# method: message/send
# params:
#   contextId: {context_id}
#   taskId: {task_id}
#   from: {sender}
#   to: {recipient}
#   timestamp: {timestamp}
# ---
#
# ## Content
#
# """

# Edge violation warning template (Issue #92)
# edge_violation_warning_mode = "compact"  # "compact" or "verbose" (default: compact)
# edge_violation_warning_template = """
# you can't talk to "{attempted_recipient}". Can talk to: {allowed_edges}.
# """

# Rules template (generated as RULES.md in session directory)
# rules_template = """
# ## Messaging Protocol
#
# ### Sending Messages
#
# 1. {reply_command}
#    - Replace `<recipient>` with the target node name
# 2. Edit the draft content
# 3. Move from draft/ to post/:
#    - draft path: {session_dir}/draft/
#    - post path: {session_dir}/post/
#
# ### Receiving Messages
#
# - Messages arrive in inbox/{your-node}/
# - After reading, move from inbox/ to read/:
#    - read path: {session_dir}/read/
#
# ### Message Format
#
# See draft template for YAML frontmatter format.
# """

# Idle reminder header template (Issue #82)
# idle_reminder_header_template = "## Idle Reminder"

# Session idle alert template (Issue #82)
# Variables: {session_name}, {idle_nodes}, {talks_to_line}
# session_idle_alert_template = """
# ## Idle Alert
#
# tmux session `{session_name}` の全ノードが停止しています。
#
# Idle nodes: {idle_nodes}
#
# {talks_to_line}
#
# Reply: `tmux-a2a-postman create-draft --to <node>`
# """

# Compaction detection header template (Issue #82)
# compaction_header_template = "## Compaction Detected"

# Watchdog idle alert template (Issue #82)
# Variables: {pane_id}, {idle_duration}, {last_activity}
# watchdog_alert_template = """
# ## Idle Alert
#
# Pane {pane_id} has been idle for {idle_duration}.
#
# Last activity: {last_activity}
# """

# Compaction notification body template (Issue #82)
# Variables: {node}
# compaction_body_template = "Compaction detected for node {node}. Please send status update."

# Dropped ball event message template (Issue #82)
# Variables: {node}, {duration}
# dropped_ball_event_template = "Dropped ball: {node} (holding for {duration})"

# =============================================================================
# Watchdog Configuration
# =============================================================================

[watchdog]
enabled = false                       # Enable watchdog monitoring
idle_threshold_seconds = 300.0        # 5 minutes
cooldown_seconds = 600.0              # 10 minutes
heartbeat_interval_seconds = 60.0     # 1 minute

[watchdog.capture]
enabled = true
tail_lines = 100
max_files = 10
max_bytes = 1048576  # 1MB

# =============================================================================
# Node-Specific Configuration
# =============================================================================
#
# Example node configuration:
#
# [example-node]
# role = "coordination, delegation"
# on_join = "Welcome message sent when node joins"
# template = """
# # EXAMPLE-NODE
#
# - Node role and responsibilities
# - Instructions and constraints
# """
# reminder_interval_seconds = 0.0    # Node-specific reminder interval (overrides global)
# reminder_message = ""              # Node-specific reminder message
# idle_timeout_seconds = 0.0         # Idle timeout (0 = disabled)
# idle_reminder_message = ""         # Idle reminder message
# idle_reminder_cooldown_seconds = 0.0
# dropped_ball_timeout_seconds = 0   # Dropped ball detection (0 = disabled)
# dropped_ball_cooldown_seconds = 0  # Dropped ball cooldown (default: same as timeout)
# dropped_ball_notification = "tui"  # "tui" (default) / "display" / "all"
